# 메인 페이지 Playwright 테스트 시나리오

## 테스트 대상

- **URL**: `http://localhost:5173/`
- **페이지**: 메인 페이지 (`src/routes/+page.svelte`)
- **기능**: 사업장 선택 → 날짜 선택 → 코트/시간대 조회 → 예약

---

## 사전 조건

- 프론트엔드 서버 실행 중 (`localhost:5173`)
- 백엔드 서버 실행 중 (`localhost:8080`)
- 테스트 계정 활성화 (user1~user10, admin1~admin3)
- DB에 테스트 데이터 존재 (파트너, 코트, 스케줄)

---

## 1. 페이지 로딩 및 초기 상태

### TC-1.1: 메인 페이지 초기 렌더링
- **단계**:
  1. `http://localhost:5173/` 접속
  2. 페이지 로딩 완료 대기
- **기대 결과**:
  - 로고 "LESGO PiCKLE" 표시
  - 태그라인 "라켓들고 LesGO!" 표시
  - 헤더에 "로그인", "회원가입" 링크 표시
  - Step 1 사업장 선택 영역 표시
  - Step 2 날짜 선택 영역 **미표시** (사업장 미선택)
  - Step 3 코트 그리드 영역 **미표시** (사업장 미선택)

### TC-1.2: 비로그인 상태 헤더
- **단계**:
  1. localStorage 비우기 (로그아웃 상태)
  2. 메인 페이지 접속
- **기대 결과**:
  - "로그인" 링크 존재
  - "회원가입" 링크 존재
  - 사용자 이름 미표시
  - "로그아웃" 버튼 미표시

### TC-1.3: 로그인 상태 헤더 (일반 회원)
- **단계**:
  1. user1 / user1!123 으로 로그인
  2. 메인 페이지로 이동
- **기대 결과**:
  - "박민수님" 또는 "user1님" 인사말 표시
  - "프로필" 링크 표시
  - "로그아웃" 버튼 표시
  - "로그인", "회원가입" 링크 미표시

### TC-1.4: 로그인 상태 헤더 (파트너)
- **단계**:
  1. admin1 / admin1!123 으로 로그인
  2. 리다이렉트 확인
- **기대 결과**:
  - `/partner` 페이지로 리다이렉트
  - 또는 헤더에 "파트너 관리" 링크 표시

---

## 2. 사업장 선택 (PartnerSelector)

### TC-2.1: 사업장 목록 로딩
- **단계**:
  1. 메인 페이지 접속
  2. 사업장 목록 로딩 완료 대기
- **기대 결과**:
  - 로딩 스피너 표시 후 사라짐
  - 사업장 카드 1개 이상 표시
  - 각 카드에 사업장명, 주소 표시

### TC-2.2: 사업장 검색
- **단계**:
  1. 검색 입력창에 "제로" 입력
  2. 300ms 디바운스 대기
- **기대 결과**:
  - "제로제로투 피클볼" 사업장 표시
  - 검색어와 무관한 사업장 미표시 또는 필터링됨

### TC-2.3: 사업장 검색 - 결과 없음
- **단계**:
  1. 검색 입력창에 "존재하지않는사업장" 입력
  2. 300ms 디바운스 대기
- **기대 결과**:
  - 빈 상태 메시지 표시 (예: "검색 결과가 없습니다")
  - 사업장 카드 0개

### TC-2.4: 사업장 선택
- **단계**:
  1. 사업장 카드 클릭
- **기대 결과**:
  - 선택된 카드에 체크마크(✓) 또는 하이라이트 표시
  - Step 2 날짜 선택 영역 표시
  - Step 3 코트 그리드 영역 표시

### TC-2.5: 사업장 변경
- **단계**:
  1. 사업장 A 선택
  2. 다른 사업장 B 클릭
- **기대 결과**:
  - 사업장 B에 하이라이트 표시
  - 사업장 A의 하이라이트 해제
  - 코트 그리드가 사업장 B의 데이터로 갱신

---

## 3. 날짜 선택 (DateSelector)

### TC-3.1: 날짜 목록 표시
- **단계**:
  1. 사업장 선택 후 날짜 선택 영역 확인
- **기대 결과**:
  - 오늘부터 7일간의 날짜 표시
  - 오늘 날짜에 "오늘" 뱃지 표시
  - 기본적으로 오늘 날짜 선택됨 (활성 상태)

### TC-3.2: 날짜 변경
- **단계**:
  1. 오늘 이외의 날짜 클릭
- **기대 결과**:
  - 클릭한 날짜가 활성 상태로 변경
  - 이전 선택 날짜의 활성 상태 해제
  - 코트 그리드가 선택된 날짜의 데이터로 갱신

### TC-3.3: 날짜 가로 스크롤
- **단계**:
  1. 날짜 영역이 화면 너비를 초과하는 경우 좌우 스크롤
- **기대 결과**:
  - 가로 스크롤 정상 동작
  - 모든 7일 날짜 접근 가능

---

## 4. 코트 그리드 (CourtGrid)

### TC-4.1: 코트 탭 표시
- **단계**:
  1. 사업장 선택 + 날짜 선택 완료
  2. 코트 그리드 로딩 대기
- **기대 결과**:
  - 코트별 탭 표시 (코트명 + 레벨 뱃지)
  - 첫 번째 코트 탭 기본 선택
  - 선택된 코트의 시간대 슬롯 목록 표시

### TC-4.2: 코트 탭 전환
- **단계**:
  1. 두 번째 코트 탭 클릭
- **기대 결과**:
  - 두 번째 코트의 시간대 슬롯 표시
  - 이전 코트 슬롯 숨겨짐

### TC-4.3: 시간대 슬롯 상태 표시
- **단계**:
  1. 코트 시간대 슬롯 목록 확인
- **기대 결과**:
  - 각 슬롯에 시작~종료 시간 표시
  - 예약 현황 표시 (예: "3/8")
  - 상태별 색상 구분:
    - 녹색: 여유 있음
    - 주황색: 일부 예약됨
    - 빨간색: 정원 마감
    - 회색: 스케줄 없음 또는 마감

### TC-4.4: 시간대 슬롯 호버 팝업
- **단계**:
  1. 예약자가 있는 시간대 슬롯에 마우스 호버
- **기대 결과**:
  - 팝업에 예약자 목록 표시
  - 확정/대기 구분 표시

### TC-4.5: 대관(RENTAL) 시간대 제한 표시
- **단계**:
  1. 대관 시간대가 있는 코트 확인 (비로그인 또는 일반 회원)
- **기대 결과**:
  - "일반 예약 불가" 텍스트 표시
  - 해당 슬롯 클릭 불가 (버튼 비활성화)
  - 정원 정보 숨김

---

## 5. 상세 모달 (DetailModal) - 비로그인

### TC-5.1: 비로그인 시 슬롯 클릭
- **단계**:
  1. 로그아웃 상태에서 시간대 슬롯 클릭
- **기대 결과**:
  - 로그인 유도 모달/프롬프트 표시
  - "로그인이 필요합니다" 또는 유사 메시지
  - 로그인 페이지 링크 제공

---

## 6. 상세 모달 (DetailModal) - 로그인

### TC-6.1: 빈 시간대 상세 보기
- **단계**:
  1. user1으로 로그인
  2. 예약자가 없는 시간대 슬롯 클릭
- **기대 결과**:
  - 상세 모달 열림
  - 코트명, 시간대 정보 표시
  - "예약 신청하기" 버튼 활성화
  - 확정/대기 섹션 비어있음

### TC-6.2: 예약자 있는 시간대 상세 보기
- **단계**:
  1. user1으로 로그인
  2. 예약자가 있는 시간대 슬롯 클릭
- **기대 결과**:
  - 확정 회원 섹션 (녹색): 순번 뱃지 + PlayerChip
  - 각 PlayerChip에 성별 아이콘, 닉네임, 레벨, DUPR 표시
  - 순번은 예약 순서대로 1, 2, 3...

### TC-6.3: 대기자 표시
- **단계**:
  1. 정원(8명) 초과 예약자가 있는 시간대 슬롯 클릭
- **기대 결과**:
  - 확정 회원 (1~8번): 녹색 섹션
  - 대기 회원 (9번~): 주황색 섹션
  - 대기 회원에 주황색 순번 뱃지

### TC-6.4: 내 예약 하이라이트
- **단계**:
  1. user1으로 로그인
  2. user1이 예약한 시간대 슬롯 클릭
- **기대 결과**:
  - 내 예약에 노란색 배경 하이라이트
  - "나" 뱃지 표시
  - "예약 취소하기" 버튼 표시 (빨간색)
  - "예약 신청하기" 버튼 미표시

### TC-6.5: 모달 닫기
- **단계**:
  1. 상세 모달 열기
  2. 모달 외부 영역 클릭 또는 X 버튼 클릭
- **기대 결과**:
  - 모달 닫힘
  - 배경 블러 해제

---

## 7. 예약 신청 (ConfirmModal)

### TC-7.1: 예약 신청 플로우 (성공)
- **단계**:
  1. user1으로 로그인
  2. 사업장 선택 → 날짜 선택 → 코트 시간대 클릭
  3. 상세 모달에서 "예약 신청하기" 클릭
  4. 확인 모달에서 예약 정보 확인
  5. "확정하기" 버튼 클릭
- **기대 결과**:
  - 확인 모달에 사업장명, 코트명, 날짜, 시간 표시
  - "게임 개시 4시간 전 이후에는 예약 취소가 제한됩니다" 경고 표시
  - API 호출 성공 (POST /api/v1/reservations)
  - 성공 토스트 표시 ("예약이 완료되었습니다" 등)
  - 모달 닫힘
  - 코트 그리드 자동 갱신 (예약자 수 증가)

### TC-7.2: 대기 예약 신청
- **단계**:
  1. 정원이 찬 시간대 슬롯 클릭
  2. "대기 예약 신청하기" 버튼 클릭
  3. 확인 모달에서 "확정하기" 클릭
- **기대 결과**:
  - 대기 예약으로 등록
  - 대기 섹션에 내 이름 추가
  - 주황색 순번 뱃지로 표시

### TC-7.3: 대기 인원 마감
- **단계**:
  1. 확정(8명) + 대기(10명) = 18명 모두 찬 시간대 확인
- **기대 결과**:
  - "대기 인원 마감" 버튼 비활성화 (disabled)
  - 예약 신청 불가

### TC-7.4: 예약 확인 모달 취소
- **단계**:
  1. "예약 신청하기" 클릭하여 확인 모달 열기
  2. "취소" 버튼 또는 모달 외부 클릭
- **기대 결과**:
  - 확인 모달 닫힘
  - 예약 생성되지 않음
  - 상세 모달로 돌아감

### TC-7.5: 중복 예약 방지
- **단계**:
  1. user1으로 이미 예약한 시간대 슬롯 클릭
- **기대 결과**:
  - "예약 신청하기" 대신 "예약 취소하기" 표시
  - 중복 예약 불가

---

## 8. 예약 취소

### TC-8.1: 예약 취소 (성공)
- **단계**:
  1. user1으로 로그인
  2. 이미 예약한 시간대 슬롯 클릭
  3. "예약 취소하기" 버튼 클릭
  4. 확인 다이얼로그에서 "확인" 클릭
- **기대 결과**:
  - API 호출 성공 (DELETE /api/v1/reservations/{id})
  - 내 예약 목록에서 제거
  - 코트 그리드 자동 갱신 (예약자 수 감소)
  - 성공 메시지 표시

### TC-8.2: 예약 취소 불가 (4시간 이내)
- **단계**:
  1. 게임 시작 4시간 이내인 예약 취소 시도
- **기대 결과**:
  - 에러 메시지 표시 ("게임 시작 4시간 전까지만 취소 가능")
  - 예약 유지

---

## 9. 성공 토스트 (SuccessToast)

### TC-9.1: 토스트 자동 닫힘
- **단계**:
  1. 예약 성공 후 토스트 표시 확인
  2. 2.5초 대기
- **기대 결과**:
  - 토스트가 화면 상단 중앙에 표시
  - pop 애니메이션 적용
  - 2.5초 후 자동 사라짐

---

## 10. 네비게이션

### TC-10.1: 로그인 페이지 이동
- **단계**:
  1. 비로그인 상태에서 헤더 "로그인" 링크 클릭
- **기대 결과**:
  - `/login` 페이지로 이동
  - 로그인 폼 표시

### TC-10.2: 로그아웃
- **단계**:
  1. 로그인 상태에서 "로그아웃" 버튼 클릭
- **기대 결과**:
  - localStorage 비워짐 (accessToken 등 삭제)
  - 헤더가 비로그인 상태로 변경
  - 메인 페이지 유지

### TC-10.3: 프로필 페이지 이동
- **단계**:
  1. 로그인 상태에서 "프로필" 링크 클릭
- **기대 결과**:
  - `/profile` 페이지로 이동

---

## 11. 반응형 디자인

### TC-11.1: 모바일 뷰포트 (375px)
- **단계**:
  1. 브라우저 뷰포트를 375x812 (iPhone X) 설정
  2. 메인 페이지 접속
- **기대 결과**:
  - 레이아웃 깨지지 않음
  - 사업장 카드 세로 배치
  - 날짜 가로 스크롤 가능
  - 코트 탭 가로 스크롤 가능
  - 모달이 화면에 맞게 조정

### TC-11.2: 태블릿 뷰포트 (768px)
- **단계**:
  1. 브라우저 뷰포트를 768x1024 (iPad) 설정
  2. 전체 예약 플로우 수행
- **기대 결과**:
  - 사업장 카드 2열 그리드
  - 모든 기능 정상 작동

### TC-11.3: 데스크톱 뷰포트 (1440px)
- **단계**:
  1. 브라우저 뷰포트를 1440x900 설정
  2. 전체 예약 플로우 수행
- **기대 결과**:
  - 사업장 카드 3~4열 그리드
  - 넓은 레이아웃 활용
  - 모든 기능 정상 작동

---

## 12. 엣지 케이스 및 에러 처리

### TC-12.1: 네트워크 에러 시 사업장 목록
- **단계**:
  1. 네트워크 요청 차단 (route.abort)
  2. 메인 페이지 접속
- **기대 결과**:
  - 에러 메시지 또는 빈 상태 표시
  - 앱 크래시 없음

### TC-12.2: API 500 에러 시 예약 신청
- **단계**:
  1. 로그인 상태에서 예약 신청
  2. API 응답을 500으로 모킹
- **기대 결과**:
  - 에러 메시지 표시
  - 확인 모달 유지 (닫히지 않음)
  - 재시도 가능

### TC-12.3: 토큰 만료 후 예약 시도
- **단계**:
  1. 로그인 후 localStorage의 accessToken을 만료된 토큰으로 교체
  2. 예약 신청 시도
- **기대 결과**:
  - 401 에러 처리
  - 로그인 페이지로 리다이렉트 또는 재로그인 유도

### TC-12.4: 페이지 새로고침 후 상태 복원
- **단계**:
  1. user1으로 로그인
  2. 사업장 선택 + 날짜 선택
  3. 브라우저 새로고침 (F5)
- **기대 결과**:
  - 로그인 상태 유지 (localStorage에서 복원)
  - 사업장/날짜 선택은 초기화될 수 있음

### TC-12.5: 빠른 연속 클릭 방어
- **단계**:
  1. "예약 신청하기" → "확정하기" 버튼을 빠르게 연속 클릭
- **기대 결과**:
  - 중복 API 호출 방지
  - 예약이 1건만 생성됨
  - 로딩 중 버튼 비활성화

---

## 13. 접근성

### TC-13.1: 키보드 네비게이션
- **단계**:
  1. Tab 키로 페이지 요소 탐색
  2. Enter 키로 선택/클릭
  3. Escape 키로 모달 닫기
- **기대 결과**:
  - 모든 인터랙티브 요소 Tab 접근 가능
  - 포커스 인디케이터 표시
  - Escape로 모달 닫힘

### TC-13.2: 스크린 리더 호환
- **단계**:
  1. 주요 요소의 aria-label 확인
- **기대 결과**:
  - 버튼, 링크에 적절한 텍스트/라벨
  - 모달에 role="dialog" 또는 유사 속성

---

## 14. E2E 통합 시나리오

### TC-14.1: 전체 예약 플로우 (Happy Path)
- **단계**:
  1. 메인 페이지 접속
  2. "로그인" 클릭 → `/login` 이동
  3. user1 / user1!123 입력 후 로그인
  4. 메인 페이지로 리다이렉트 확인
  5. "제로제로투 피클볼" 사업장 선택
  6. 오늘 날짜 선택 (기본)
  7. 첫 번째 코트 탭 확인
  8. 여유 있는 시간대 슬롯 클릭
  9. 상세 모달에서 예약자 목록 확인
  10. "예약 신청하기" 클릭
  11. 확인 모달에서 정보 확인
  12. "확정하기" 클릭
  13. 성공 토스트 확인
  14. 코트 그리드에 예약자 수 증가 확인
  15. 같은 슬롯 재클릭 → 내 이름 확인 + "예약 취소하기" 버튼 확인
- **기대 결과**: 전 과정 에러 없이 완료

### TC-14.2: 예약 후 취소 플로우
- **단계**:
  1. TC-14.1 완료 후
  2. 예약한 시간대 슬롯 클릭
  3. "예약 취소하기" 클릭
  4. 취소 확인
  5. 코트 그리드에 예약자 수 감소 확인
- **기대 결과**: 예약 취소 후 정상 상태 복원

### TC-14.3: 다중 사용자 시나리오
- **단계**:
  1. user1으로 예약 신청
  2. 로그아웃
  3. user2로 로그인
  4. 같은 시간대 슬롯 확인 → user1의 예약 확인
  5. user2도 예약 신청
  6. 슬롯에 두 명의 예약자 확인
- **기대 결과**: 서로 다른 유저의 예약이 정상 반영

---

## 테스트 우선순위

| 우선순위 | 테스트 ID | 설명 |
|---------|----------|------|
| P0 (필수) | TC-1.1 | 페이지 초기 로딩 |
| P0 | TC-2.1, TC-2.4 | 사업장 목록 및 선택 |
| P0 | TC-4.1, TC-4.3 | 코트 그리드 및 슬롯 상태 |
| P0 | TC-7.1 | 예약 신청 성공 |
| P0 | TC-8.1 | 예약 취소 성공 |
| P0 | TC-14.1 | E2E Happy Path |
| P1 (중요) | TC-1.2, TC-1.3 | 인증 상태별 헤더 |
| P1 | TC-5.1 | 비로그인 슬롯 클릭 |
| P1 | TC-6.4 | 내 예약 하이라이트 |
| P1 | TC-7.2, TC-7.3 | 대기 예약 / 마감 |
| P1 | TC-7.5 | 중복 예약 방지 |
| P1 | TC-12.4 | 새로고침 상태 복원 |
| P2 (보통) | TC-2.2, TC-2.3 | 사업장 검색 |
| P2 | TC-3.1, TC-3.2 | 날짜 선택 |
| P2 | TC-4.5 | 대관 제한 표시 |
| P2 | TC-6.2, TC-6.3 | 예약자/대기자 상세 |
| P2 | TC-9.1 | 성공 토스트 |
| P2 | TC-10.1~10.3 | 네비게이션 |
| P3 (낮음) | TC-11.1~11.3 | 반응형 디자인 |
| P3 | TC-12.1~12.3 | 에러/엣지 케이스 |
| P3 | TC-12.5 | 연속 클릭 방어 |
| P3 | TC-13.1~13.2 | 접근성 |

---

## 테스트 데이터 요구사항

| 계정 | 용도 |
|------|------|
| user1 (박민수) | 일반 회원 예약/취소 테스트 |
| user2 (김영희) | 다중 사용자 테스트 |
| user4~user10 | 대기자 시스템 테스트 (정원 채우기) |
| admin1 | 파트너 계정 리다이렉트 테스트 |

---

*작성일: 2026-02-13*
*총 테스트 케이스: 37개 (14개 카테고리)*
